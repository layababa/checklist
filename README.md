# 发版确认清单系统（Release Checklist）

## 🎯 项目简介

发版确认清单系统是一个支持多角色分权、实时协作的发布前确认工具。支持产品、测试、前端、后端等多角色对发版过程中的各个环节进行确认，确保每个发布流程都有迹可循，责任清晰。

### 核心特性

- 🔐 **多角色权限控制**：产品、测试、前端、后端各自仅能编辑属于自己的区域
- 🔒 **"点击即提交、提交即锁定"**：防止反悔修改，确保发版责任明确
- 👁️ **免登录查看**：支持查看清单内容，提交时需要登录
- 📊 **实时进度统计**：显示各角色的完成进度百分比
- 📱 **移动端适配**：完整的响应式设计
- ⚡ **即时反馈**：每个操作都实时同步到服务端

## 🚀 快速开始

### 环境要求

- Node.js >= 16
- npm 或 yarn

### 安装依赖

```bash
npm install
```

### 开发环境运行

```bash
npm run dev
```

应用将在 `http://localhost:5173` 启动

### 生产环境构建

```bash
npm run build
```

构建产物在 `dist` 目录下

### 预览生产构建

```bash
npm run preview
```

## 📁 项目结构

```
src/
├── api/                      # API 接口模块
│   ├── http.ts              # Axios 实例配置
│   └── workflow.ts          # 发布清单接口
├── components/              # 可复用组件
│   ├── LoginDialog.vue      # 登录弹框
│   ├── RoleLockSwitch.vue   # 角色权限开关
│   ├── ConfirmableTextarea.vue  # 可确认文本域
│   └── ConfirmableDate.vue  # 可确认日期选择
├── pages/                    # 页面
│   ├── Checklists.vue       # 清单列表页
│   └── OneChecklist.vue     # 清单详情页
├── router/                   # 路由配置
│   └── index.ts
├── stores/                   # Pinia 状态管理
│   └── auth.ts             # 鉴权相关状态
├── styles/                   # 全局样式
│   └── global.css
├── utils/                    # 工具函数
│   ├── role.ts             # 角色权限工具
│   └── fields.ts           # 字段分组、锁定等工具
├── App.vue                  # 根组件
└── main.ts                  # 应用入口
```

## ⚙️ 环境配置

### 环境变量

在项目根目录创建 `.env` 或 `.env.development` 文件，配置以下变量：

```
VITE_API_BASE_URL=http://web.flimzor.xyz/stage-api
```

- `VITE_API_BASE_URL`：后端 API 基础地址（默认：`http://web.flimzor.xyz/stage-api`）

### API 接口

系统依赖以下后端接口（详见 `api.md`）：

| 方法 | 端点 | 说明 |
|------|------|------|
| POST | `/login` | 用户登录 |
| GET | `/system/workflow/list` | 获取清单列表 |
| GET | `/system/workflow/:id` | 获取单个清单 |
| POST | `/system/workflow` | 创建新清单 |
| PUT | `/system/workflow` | 更新清单字段 |
| DELETE | `/system/workflow/:id` | 删除清单 |

## 👥 用户角色与权限

### 角色定义（role）

| 角色 | code | 权限 |
|------|------|------|
| 产品 | 0 | 编辑更新内容、产品确认、产品验收、产品全员确认 |
| 测试 | 1 | 编辑测试环境确认、测试验收、测试功能验证、测试全员确认 |
| 前端 | 2 | 编辑预发布前端部署、生产前端运维发布、前端全员确认 |
| 后端 | 3 | 编辑预发布运维和服务端、生产运维发布、后端全员确认 |

### 编辑权限

每个角色仅能编辑属于自己的相关字段。非权限区域的字段始终显示为禁用状态，鼠标悬浮显示"无权限编辑"提示。

## 🔐 登录与鉴权

### 登录流程

1. 点击页面顶部"登录"按钮
2. 输入账号密码（测试账号：admin/admin123）
3. 登录成功后，token 存储在 `localStorage`，自动关联用户角色

### Token 管理

- Token 存储在 `localStorage` 中，key 为 `token`
- 用户角色存储在 `localStorage` 中，key 为 `userRole`
- API 请求时自动在 `Authorization` 头中携带 token
- 收到 401 响应时自动清除 token 并弹出登录框

### 免登录查看

两个页面均支持免登录查看清单内容，但编辑操作（点击开关、确认按钮）需要登录。

## 📋 功能说明

### 列表页（/checklists）

- **筛选功能**：支持按上线日期范围、关键字搜索
- **进度显示**：四栏分别显示产品、测试、前端、后端的完成进度（百分比）
- **新建清单**：登录后点击"新建清单"可创建新发版清单
- **跳转详情**：点击表格中的"查看"进入详情页

### 详情页（/checklists/:id）

页面分为四个主要区块，对应不同的发版环节：

#### 1. 📝 更新内容
- 上线时间（产品编辑）
- 前端更新内容与额外说明（前端编辑）
- 后端更新内容与额外说明（后端编辑）
- 表结构涉及更新与额外说明（后端编辑）

#### 2. 🧪 测试环境确认
- **产品确认**：需求变更、PRD 文档、前端/后端需求匹配
- **测试确认**：前端/后端测试完成情况
- **回归测试**：核心功能、关联功能、bug 修复情况

#### 3. 📦 预发布流程确认
- **运维确认**：表结构变更审查、脚本、执行情况
- **服务端部署**：代码更新、服务启动、日志、配置检查
- **前端部署**：代码发布、资源更新、CDN、页面访问
- **测试验收**：新功能、流程、数据、性能验证
- **产品验收**：功能、体验、文案/UI、业务流程验证

#### 4. 🚀 生产流程确认
- **运维发布**：预发布验收、数据库、代码、服务、检查、监控
- **前端运维发布**：代码、CDN、页面访问
- **测试功能验证**：新功能、核心功能、流程、数据一致性验证
- **全员确认**：各角色最终确认

### 控件说明

#### 开关（Switch）
- 仅支持 false → true，确认后无法取消
- 确认后开关禁用，无法修改
- 如确实需要回滚，请联系管理员

#### 文本域与日期选择
- 右侧配备"确定"按钮
- 输入/修改内容后，点击"确定"即时提交
- 提交成功后禁用输入框和按钮
- 显示"✓ 已确认"标签

## 🎨 UI 组件

### Element Plus
项目使用 Element Plus 作为 UI 框架，所有组件均采用最新的 Vue 3 Composition API。

### 响应式设计
- PC 端（>1024px）：两列网格
- 平板端（768-1024px）：自适应调整
- 手机端（<768px）：单列布局，表格横向滚动

## 🔧 开发指南

### 添加新字段

1. 在 `src/utils/fields.ts` 的 `fieldGroups` 中定义字段
2. 在 `src/utils/role.ts` 的 `editableFields` 中配置权限
3. 在 `src/pages/OneChecklist.vue` 中添加对应的组件

### 修改 API 接口

1. 在 `src/api/workflow.ts` 中更新接口定义
2. 在 `src/api/http.ts` 中配置拦截器（如需要）

### 自定义样式

- 全局样式：`src/styles/global.css`
- 组件样式：在各组件的 `<style scoped>` 中定义

## 🚨 常见问题

### Q: 为什么已确认的项无法修改？
A: 这是系统设计的一部分，确保发版责任明确。如需修改，请联系管理员进行数据回滚。

### Q: 能否以其他角色的身份编辑？
A: 不能。系统基于登录账号的角色进行权限控制。如需以其他角色进行操作，请用对应角色的账号登录。

### Q: 列表不显示怎么办？
A: 
1. 检查后端 API 服务是否正常运行
2. 确认环境变量 `VITE_API_BASE_URL` 是否正确
3. 打开浏览器开发者工具，查看 Network 标签中的请求是否成功

### Q: 登录失败提示错误怎么办？
A: 
1. 确认输入的账号密码是否正确
2. 检查后端登录接口是否正常
3. 查看浏览器开发者工具 Console 中的错误信息

## 📝 许可证

内部项目，仅供团队使用。

## 🤝 支持

如有问题或建议，请联系技术负责人。

